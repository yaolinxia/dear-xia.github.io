---
layout: post
title: "检查点"
tag: OCR
---

Checkpoint在一致性数据库关闭、实例恢复和数据库操作方面提供一种关键机制。有下面相关的含义：

- 显示检查点位置的数据结构，是重做流中的SCN，用来实例恢复必须开始的地方；检查点的位置有数据库缓冲区中最老的脏缓冲区决定，检查点位置作为一个指针指向重做流，存储在控制文件和每个数据文件头部；

- 在数据库缓冲区缓存将修改的数据库缓冲区写入磁盘；

**检查点进程**

检查点进程（CKPT）使用检查点信息来更新控制文件和数据文件头部，并给DBWn发信号将块写入磁盘。检查点信息包括检查点位置、SCN，开始恢复的在线重做日志的位置等。

在数据库系统中，写日志和写数据文件是数据库中IO消耗最大的两种操作，在这两种操作中写数据文件属于分散写，写日志文件是顺序写，因此为了保证数据库的性能，通常数据库都是保证在提交（commit）完成之前要先保证日志都被写入到日志文件中，而脏数据块着保存在数据缓存（buffer cache）中再不定期的分批写入到数据文件中。也就是说日志写入和提交操作是同步的，而数据写入和提交操作是不同步的。这样就存在一个问题，当一个数据库崩溃的时候并不能保证缓存里面的脏数据全部写入到数据文件中，这样在实例启动的时候就要使用日志文件进行恢复操作，将数据库恢复到崩溃之前的状态，保证数据的一致性。检查点是这个过程中的重要机制，通过它来确定，恢复时哪些重做日志应该被扫描并应用于恢复。一般所说的checkpoint是一个数据库事件（event），checkpoint事件由checkpoint进程（LGWR/CKPT进程）发出，当checkpoint事件发生时DBWn会将脏块写入到磁盘中，同时数据文件和控制文件的文件头也会被更新以记录checkpoint信息。

**checkpoint的作用?**
通俗的说checkpoint就像word的自动保存一样。

checkpoint的2个主要作用：

- 保证数据库的一致性，这是指将脏数据写入到硬盘，保证内存和硬盘上的数据是一样的；
- 缩短实例恢复的时间，实例恢复要把实例异常关闭前没有写出到硬盘的脏数据通过日志进行恢复。如果脏块过多，实例恢复的时间也会很长，检查点的发生可以减少脏块的数量，从而提高实例恢复的时间。





### 参考网址：

- <https://www.tensorflowers.cn/t/5502>
- <https://blog.csdn.net/zkl99999/article/details/80902614>

